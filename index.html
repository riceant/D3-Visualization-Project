<html>
<head>
	<title>CS3300 Project 3 </title>
	<link rel="stylesheet" type="text/css" href="css/styles.css">
	<script src="http://code.jquery.com/jquery-1.11.0.min.js" charset="utf-8"></script>
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<style type="text/css">
		.canvas {
			background-color: #b7b7b7;
		}
		.body {
			fill: white;
			stroke: black;
			stroke-width: 1;
		}
	</style>
<head>

<body>
<h1>Add Content Below </h1>
<p> Test </p>

	<input id="slider" type="range" min="800" max="1200" value="1000"/>
	
	<div id="divCanvas"></div>

	<script type="text/javascript">

		//dimensions of canvas
		var heightSVG = 1000;
		var width = 400;

		//creating svg element
		var svg = d3.select("#divCanvas")
			.append("svg")
			.attr("class", "canvas")
			.attr("id", "canvas")
			.attr("width", width)
			.attr("height", heightSVG)
			.attr("viewBox", "0 0 " + width + " " + heightSVG)
			.attr("preserveAspectRatio", "none");

		//body dimension variables
		var density = 1.05;
		var age = 30;
		var weight = 160;
		var height = 70;
		var neck = 38;
		var chest = 95;
		var abs = 90;
		var hip = 98
		var thigh = 58;
		var knee = 38;
		var ankle = 23;
		var bicep = 32;
		var forearm = 28;
		var wrist = 18;

		//conversion and scale functions
		///////////////////////////////////////////////////////////////////////
		//conversion functions
		//function converting circumference to diameter
		var dia = function(measurement) {
			return measurement/3.14; 
		}
		//function converting inches to centimeters
		var cm = function(measurement) {
			return measurement*2.54;
		}
		//scales: 180 cm is scaled to roughly 800 pixels
		//padding for yScale
		var heightPadding = 50;
		//yScale
		var heightScale = d3.scale.linear()
			.domain([0,214])
			.range([heightSVG-heightPadding,0]);
		//general scale
		var scale = d3.scale.linear()
			.domain([0,214])
			.range([0,heightSVG-heightPadding]);


		//useful canvas dimensions and body portion lengths
		var center = width/2;
		var bottom = heightPadding;
		var division = cm(height)/8;


		//placement functions
		///////////////////////////////////////////////////////////////////////
		//function calculating left position of centered aligned rect
		var placeCenter = function(circumference) {
			return center - scale(dia(circumference)*.5);
		}
		//function calculating right position of centered aligned rect
		var placeCenterR = function(outside) {
			return center + scale(dia(outside)*.5);
		}
		//function calculating left position of rect alighed left of center
		var placeLeft = function(circumference) {
			return center - scale(dia(circumference));
		}
		//function calculating right position of rect aligned right of center
		var placeRight = function(circumference) {
			return center + scale(dia(circumference));
		}
		//function calculaing pixel diameter 
		var pixelWidth = function(circumference) {
			return scale(dia(circumference));
		}

		//drawing human figure with shapes
		///////////////////////////////////////////////////////////////////////
		//neck
		svg.append("rect")
			.attr("class", "body")
			.attr("id", "neck")
			.attr("x", placeCenter(neck))
			.attr("y", heightScale(division*7.2))
			.attr("width", pixelWidth(neck))
			.attr("height", scale(division*.4));
		//head
		svg.append("ellipse")
			.attr("class", "body")
			.attr("id", "head")
			.attr("cx", center)
			.attr("cy", heightScale(division*7.5))
			.attr("rx", scale(division*(.7)*.5))
			.attr("ry", scale(division*.5));
		//chest
		svg.append("rect")
			.attr("class", "body")
			.attr("id", "chest")
			.attr("x", placeCenter(chest))
			.attr("y", heightScale(division*6.8))
			.attr("width", pixelWidth(chest))
			.attr("height", scale(division*1.2));
		//abdomen
		svg.append("rect")
			.attr("class", "body")
			.attr("id", "chest")
			.attr("x", placeCenter(abs))
			.attr("y", heightScale(division*5.6))
			.attr("width", pixelWidth(abs))
			.attr("height", scale(division*1.1));
		//hip
		svg.append("rect")
			.attr("class", "body")
			.attr("id", "hip")
			.attr("x", placeCenter(hip))
			.attr("y", heightScale(division*4.5))
			.attr("width", pixelWidth(hip))
			.attr("height", scale(division*.5));
		//bicep left
		svg.append("rect")
			.attr("class", "body")
			.attr("id", "bicep")
			.attr("x", placeCenter(chest+2*bicep))
			.attr("y", heightScale(division*6.8))
			.attr("width", pixelWidth(bicep))
			.attr("height", scale(division*1.8));
		//bicep right
		svg.append("rect")
			.attr("class", "body")
			.attr("id", "bicep")
			.attr("x", placeCenterR(chest))
			.attr("y", heightScale(division*6.8))
			.attr("width", pixelWidth(bicep))
			.attr("height", scale(division*1.8));
		//forearm left
		svg.append("rect")
			.attr("class", "body")
			.attr("id", "forearm")
			.attr("x", placeCenter(chest+bicep+forearm))
			.attr("y", heightScale(division*5))
			.attr("width", pixelWidth(forearm))
			.attr("height", scale(division*1));
		//forearm right
		svg.append("rect")
			.attr("class", "body")
			.attr("id", "forearm")
			.attr("x", placeRight(chest*.5 + .5*(bicep-forearm)))
			.attr("y", heightScale(division*5))
			.attr("width", pixelWidth(forearm))
			.attr("height", scale(division*1));
		//thigh left
		svg.append("rect")
			.attr("class", "body")
			.attr("id", "thigh")
			.attr("x", placeLeft(thigh))
			.attr("y", heightScale(division*4))
			.attr("width", pixelWidth(thigh))
			.attr("height", scale(division*1.7));
		//thigh right
		svg.append("rect")
			.attr("class", "body")
			.attr("id", "thigh")
			.attr("x", center)
			.attr("y", heightScale(division*4))
			.attr("width", pixelWidth(thigh))
			.attr("height", scale(division*1.7));
		//wrist left
		svg.append("rect")
			.attr("class", "body")
			.attr("id", "wrist")
			.attr("x", placeCenter(chest+bicep+wrist))
			.attr("y", heightScale(division*4))
			.attr("width", pixelWidth(wrist))
			.attr("height", scale(division*.1));
		//wrist left
		svg.append("rect")
			.attr("class", "body")
			.attr("id", "wrist")
			.attr("x", placeRight(chest*.5 + .5*(bicep-wrist)))
			.attr("y", heightScale(division*4))
			.attr("width", pixelWidth(wrist))
			.attr("height", scale(division*.1));
		//lower leg left-->calf: width = 0.7*thigh
		svg.append("rect")
			.attr("class", "body")
			.attr("id", "calf")
			.attr("x", placeLeft(thigh*.85))
			.attr("y", heightScale(division*2.2))
			.attr("width", pixelWidth(thigh*.7))
			.attr("height", scale(division*1.9));
		//lower leg right-->calf: width = 0.7*thigh
		svg.append("rect")
			.attr("class", "body")
			.attr("id", "calf")
			.attr("x", placeRight(thigh*.15))
			.attr("y", heightScale(division*2.2))
			.attr("width", pixelWidth(thigh*.7))
			.attr("height", scale(division*1.9));
		//knee left
		svg.append("circle")
			.attr("class", "body")
			.attr("id", "knee")
			.attr("cx", placeLeft(thigh*.5))
			.attr("cy", heightScale(division*2.25))
			.attr("r", scale(dia(knee)*.5));
		//knee right
		svg.append("circle")
			.attr("class", "body")
			.attr("id", "knee")
			.attr("cx", placeRight(thigh*.5))
			.attr("cy", heightScale(division*2.25))
			.attr("r", scale(dia(knee)*.5));
		//feet-->based on height: width = 0.7*division
		//foot left
		svg.append("rect")
			.attr("class", "body")
			.attr("id", "feet")
			.attr("x", placeLeft(thigh*.15) - scale(division*.7))
			.attr("y", heightScale(division*.3))
			.attr("width", scale(division*.7))
			.attr("height", scale(division*.3));
		//foot right
		svg.append("rect")
			.attr("class", "body")
			.attr("id", "feet")
			.attr("x", placeRight(thigh*.15))
			.attr("y", heightScale(division*.3))
			.attr("width", scale(division*.7))
			.attr("height", scale(division*.3));


		//style appending
		d3.selectAll(".body")
			.attr("rx", "10")
			.attr("ry", "10");
		d3.selectAll("#wrist")
			.attr("rx", "2")
			.attr("ry", "2");
		d3.select("#head")
			.attr("rx", scale(division*(.7)*.5))
			.attr("ry", scale(division*.5));
		// d3.selectAll("#feet")
		// 	.attr("rx", "3")
		// 	.attr("ry", "3");


		//height slider
		///////////////////////////////////////////////////////////////////////
		document.getElementById("slider").onchange =
			function () {
				var setting = "0 0 400 " + document.getElementById("slider").value;
				document.getElementById("canvas").setAttribute("viewBox", setting);
				console.log(setting);
			};

	</script>

	<h1>Parsing Data</h1>
	<script type="text/javascript">
	/*
	$.getJSON("data/BodyFat.json", function(json) {
    	console.log(json);
    });
*/
	
	d3.json("data/BodyFat.json", function (data) {
		var calcFitY;
		function fitLine(xVar,yVar){
			var sumX = 0;
			var sumY = 0;
			var sumXY = 0;
			var sumXsq = 0;
			data.forEach(function(element){
				sumX += element[xVar];
				sumY += element[yVar];
				sumXY += element[xVar]*element[yVar];
				sumXsq += element[xVar]*element[xVar];
			})
			var slope = (data.length*sumXY - (sumX*sumY))/(data.length*sumXsq - (sumX*sumX));
			var intercept = ((sumY - (slope*sumX))/data.length);
			return calcFitY = function(x){
				return slope*x+intercept;
			}
		}
		function minmax(variable){
			minmaxArr = {};
			data.forEach(function(element){
				sumX += element[variable];
				sumY += element[yVar];
				sumXY += element[xVar]*element[yVar];
				sumXsq += element[xVar]*element[xVar];
			})
		}
		calcFitYWrist = fitLine('WristC', 'PercentBodyFat');
		console.log(calcFitYWrist(27));
		calcFitYChest = fitLine('ChestC', 'PercentBodyFat');
		console.log(calcFitYChest(27));
		console.log(calcFitYWrist(27));
	})

	</script>
</body>
</html>